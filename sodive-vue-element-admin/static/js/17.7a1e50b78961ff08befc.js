webpackJsonp([17],{OUpK:function(t,e){},qHma:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("BO1k"),i=s.n(a),r=s("d7EF"),n=s.n(r),l=s("1uAe"),o=s("0xDb"),u=[{status:"effective",label:"启用中"},{status:"ineffective",label:"停用中"}].reduce(function(t,e){return t[e.status]=e.label,t},{}),c={name:"taskManage",data:function(){return{list:null,total:1,listQuery:{page:1},loading:!0,visible:!1,visible1:!1,isEdit:!1,push:"",taskForm:{taskName:"",taskDescription:"",isAble:"",subTaskId:null,taskId:null},taskRules:{taskName:[{required:!0,trigger:"blur",message:"请输入子任务名称"}],taskDescription:[{required:!0,trigger:"blur",message:"请对子任务进行描述"}],isAble:[{required:!0,trigger:"blur",message:"请选择是否启用"}]}}},created:function(){this.GetTaskManage()},methods:{GetTaskManage:function(){var t=this;this.loading=!0,Object(l.n)(this.listQuery).then(function(e){t.list=e.data.taskManage,t.total=e.data.total,t.loading=!1})},changeSubTaskStatus:function(t){"effective"===t.status?(t.status="ineffective",t.subTask.forEach(function(t){t.subStatus="ineffective"})):(t.status="effective",t.subTask.forEach(function(t){t.subStatus="effective"}))},pushInfo:function(){""===this.push?this.$message.warning("请选择推送对象"):(this.$message.success("推送成功"),this.visible1=!1)},editTask:function(t){this.visible=!0,this.isEdit=!0,this.taskForm.taskName=t.subTaskName,this.taskForm.taskDescription=t.taskDescription,this.taskForm.isAble=t.subStatus,this.taskForm.subTaskId=t.subTaskId},submitForm:function(){var t=this;this.$refs.taskForm.validate(function(e){if(e){if(t.isEdit){var s=!0,a=!1,r=void 0;try{for(var l,u=i()(t.list.entries());!(s=(l=u.next()).done);s=!0){var c=l.value,d=n()(c,2),f=d[0],k=d[1],b=!0,v=!1,m=void 0;try{for(var p,_=i()(k.subTask.entries());!(b=(p=_.next()).done);b=!0){var g=p.value,h=n()(g,2),T=h[0];if(h[1].subTaskId===t.taskForm.subTaskId){t.list[f].updateTime=Object(o.a)(),t.list[f].subTask[T].subTaskName=t.taskForm.taskName,t.list[f].subTask[T].taskDescription=t.taskForm.taskDescription,t.list[f].subTask[T].subStatus=t.taskForm.isAble,t.$notify({title:"编辑成功",message:"成功修改该子任务状态",type:"success"});break}}}catch(t){v=!0,m=t}finally{try{!b&&_.return&&_.return()}finally{if(v)throw m}}}}catch(t){a=!0,r=t}finally{try{!s&&u.return&&u.return()}finally{if(a)throw r}}}else{var y=!0,F=!1,w=void 0;try{for(var x,S=i()(t.list.entries());!(y=(x=S.next()).done);y=!0){var N=x.value,I=n()(N,2),D=I[0];if(I[1].taskId===t.taskForm.taskId){t.list[D].updateTime=Object(o.a)(),t.list[D].subTask.push({subTaskName:t.taskForm.taskName,taskDescription:t.taskForm.taskDescription,subStatus:t.taskForm.isAble,subTaskId:(1e5*Math.random()).toFixed(0)}),t.$notify({title:"创建成功",message:"成功创建该子任务状态",type:"success"});break}}}catch(t){F=!0,w=t}finally{try{!y&&S.return&&S.return()}finally{if(F)throw w}}}t.visible=!1}})},resetForm:function(){this.taskForm={taskName:"",taskDescription:"",isAble:"",taskId:null}},addTask:function(t){var e=this;this.resetForm(),this.$nextTick(function(){e.$refs.taskForm.clearValidate()}),this.taskForm.taskId=t.taskId,this.isEdit=!1,this.visible=!0}},filters:{regionFilter:function(t){return{all:"全部",China:"中国",abroad:"海外"}[t]},mainTaskFilter:function(t){return{ineffective:"失效",effective:"正常"}[t]},mainTaskTagFilter:function(t){return{ineffective:"danger",effective:"success"}[t]},editMainTaskStatus:function(t){return{ineffective:"启用主任务",effective:"停用主任务"}[t]},taskStatusFilter:function(t){return u[t]},taskTagFilter:function(t){return{effective:"success",ineffective:"danger"}[t]}}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"task-manage-container"},[s("el-header",[s("div",{staticClass:"filter-container"},[s("div",{staticClass:"filter-item",staticStyle:{"line-height":"60px"}},[t._v("\n        备注：子任务状态由主任务状态决定，子任务可单独设置状态是否启用\n      ")]),t._v(" "),s("div",{staticClass:"filter-item fr"},[s("router-link",{attrs:{to:"/operationManagement/taskManage/editTask"}},[s("el-button",{attrs:{type:"primary"}},[t._v("新增主任务"),s("i",{staticClass:"el-icon-circle-plus"})])],1)],1)])]),t._v(" "),s("el-main",[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{"text-align":"center"},attrs:{data:t.list,border:"","element-loading-text":"小主,我需要时间..."}},[s("el-table-column",{attrs:{label:"任务名称",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("router-link",{attrs:{to:"userNumberRecord/"+e.row.taskId}},[t._v(t._s(e.row.taskName))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"创建时间",prop:"createTime",width:"170px"}}),t._v(" "),s("el-table-column",{attrs:{label:"更新时间",prop:"updateTime",width:"170px"}}),t._v(" "),s("el-table-column",{attrs:{label:"显示区域",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(t._f("regionFilter")(e.row.showRegion)))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"子任务",width:"180px"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-dropdown",{attrs:{"split-button":"",type:"primary"}},[t._v("\n            子任务列表\n            "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(e.row.subTask,function(e){return s("el-dropdown-item",{key:e.subTaskId},[s("span",{staticClass:"subTaskName",on:{click:function(s){t.editTask(e)}}},[t._v(t._s(e.subTaskName))]),t._v(" "),s("el-tag",{attrs:{type:t._f("mainTaskTagFilter")(e.subStatus)}},[t._v(t._s(t._f("taskStatusFilter")(e.subStatus)))])],1)}))],1)]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"主任务状态",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tag",{attrs:{type:t._f("mainTaskTagFilter")(e.row.status)}},[t._v(t._s(t._f("mainTaskFilter")(e.row.status)))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"操作",width:"130px"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-dropdown",{attrs:{type:"primary"}},[s("el-button",{attrs:{type:"primary"}},[t._v("\n              操作"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",[s("el-button",{attrs:{type:t._f("mainTaskTagFilter")(e.row.status)},on:{click:function(s){t.changeSubTaskStatus(e.row)}}},[t._v(t._s(t._f("editMainTaskStatus")(e.row.status)))])],1),t._v(" "),s("el-dropdown-item",[s("el-button",{attrs:{type:"text"},on:{click:function(e){t.visible1=!0}}},[t._v("推送消息")])],1),t._v(" "),s("el-dropdown-item",[s("router-link",{attrs:{to:"/operationManagement/taskManage/editTask/"+e.row.taskId}},[s("el-button",{attrs:{type:"text"}},[t._v("编辑主任务")])],1)],1),t._v(" "),s("el-dropdown-item",[s("el-button",{attrs:{type:"text"},on:{click:function(s){t.addTask(e.row)}}},[t._v("增加子任务")])],1)],1)],1)]}}])})],1)],1),t._v(" "),s("el-footer",[s("pagination",{attrs:{total:t.total,listQuery:t.listQuery,GetList:t.GetTaskManage}})],1),t._v(" "),s("el-dialog",{attrs:{title:"推送消息",visible:t.visible1},on:{"update:visible":function(e){t.visible1=e}}},[s("el-radio-group",{model:{value:t.push,callback:function(e){t.push=e},expression:"push"}},[s("el-radio",{attrs:{label:"all"}},[t._v("全部")]),t._v(" "),s("el-radio",{attrs:{label:"China"}},[t._v("中国")]),t._v(" "),s("el-radio",{attrs:{label:"abroad"}},[t._v("海外")])],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.visible1=!1}}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.pushInfo}},[t._v("确定")])],1)],1),t._v(" "),s("el-dialog",{staticClass:"task-container",attrs:{title:"编辑/新增子任务",visible:t.visible},on:{"update:visible":function(e){t.visible=e}}},[s("el-form",{ref:"taskForm",attrs:{model:t.taskForm,rules:t.taskRules}},[s("el-form-item",{attrs:{label:"任务名称",prop:"taskName"}},[s("el-input",{model:{value:t.taskForm.taskName,callback:function(e){t.$set(t.taskForm,"taskName",e)},expression:"taskForm.taskName"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"任务描述",prop:"taskDescription"}},[s("el-input",{model:{value:t.taskForm.taskDescription,callback:function(e){t.$set(t.taskForm,"taskDescription",e)},expression:"taskForm.taskDescription"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"是否启用",prop:"isAble"}},[s("el-radio-group",{model:{value:t.taskForm.isAble,callback:function(e){t.$set(t.taskForm,"isAble",e)},expression:"taskForm.isAble"}},[s("el-radio",{attrs:{label:"effective"}},[t._v("启用")]),t._v(" "),s("el-radio",{attrs:{label:"ineffective"}},[t._v("不启用")])],1)],1)],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("确定")])],1)],1)],1)},staticRenderFns:[]};var f=s("VU/8")(c,d,!1,function(t){s("OUpK")},"data-v-8eb9b31e",null);e.default=f.exports}});